{"version":3,"sources":["webpack://ckeditor-axe/./src/plugin.js"],"names":["CKEDITOR","plugins","add","lang","onLoad","axe","context","undefined","run","rules","enabled","bypass","region","callback","error","results","editorName","console","log","instances","editor","violations","nodes","forEach","violation","vid","title","help","description","node","target","document","$","querySelector","dir","path","override","settings","mandatoryRules","Object","keys","key","scripts","querySelectorAll","length","src","callbackNumber","tools","addFunction","init","plugin","config","on","frame","getHead","append","createElement","attributes","type","defer","ui","addButton","label","name","command","icon","toolbar","addCommand","canUndo","exec","message","arguments","options","getWindow","postMessage"],"mappings":"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","file":"plugin.js","sourcesContent":["\"use strict\";\n\n(function(CKEDITOR) {\n  CKEDITOR.plugins.add(\"axe\", {\n    // @todo: Investigate axe-core languages system.\n    lang: \"en\",\n    /**\n     * Pre initialization hook.\n     *\n     * In this function we have definitions of default values for plugin settings.\n     */\n    onLoad: function() {\n      // At this point we are going to provide default options for this plugin.\n      let axe = {};\n\n      /**\n       * Default context is \"document\".\n       *\n       * If value of context is undefined - \"document\" will be used instead.\n       * If you need detailed configuration @see: https://www.deque.com/axe/axe-for-web/documentation/api-documentation/#user-content-api-name-axerun\n       */\n      axe.context = undefined;\n\n      /**\n       * Settings section which will be passed into aXe run command as options.\n       */\n      axe.run = {};\n\n      /**\n       * Tags to use to get default set of rules.\n       *\n       * By default we are going to use validation by tags.\n       * And default tag is \"wcag2a\".\n       */\n      // axe.run.runOnly = {\n      //   type: \"tag\",\n      //   values: [\"wcag2a\"]\n      // };\n\n      /**\n       * Rules to exclude from check.\n       *\n       * For details @see: https://www.deque.com/axe/axe-for-web/documentation/api-documentation/#user-content-options-parameter-examples\n       * List of rules below are excluded because they are not applicable to CKEditor functionality.\n       * By logic of this plugin it should be impossible to override this lis list of rules and their values.\n       */\n      axe.run.rules = {\n        \"aria-hidden-body\": { enabled: false },\n        bypass: { enabled: false },\n        \"document-title\": { enabled: false },\n        \"frame-tested\": { enabled: false },\n        \"frame-title-unique\": { enabled: false },\n        \"frame-title\": { enabled: false },\n        \"html-has-lang\": { enabled: false },\n        \"html-lang-valid\": { enabled: false },\n        \"html-xml-lang-mismatch\": { enabled: false },\n        \"landmark-banner-is-top-level\": { enabled: false },\n        \"landmark-complementary-is-top-level\": { enabled: false },\n        \"landmark-contentinfo-is-top-level\": { enabled: false },\n        \"landmark-main-is-top-level\": { enabled: false },\n        \"landmark-no-duplicate-banner\": { enabled: false },\n        \"landmark-no-duplicate-contentinfo\": { enabled: false },\n        \"landmark-one-main\": { enabled: false },\n        \"meta-viewport-large\": { enabled: false },\n        \"meta-viewport\": { enabled: false },\n        \"page-has-heading-one\": { enabled: false },\n        region: { enabled: false },\n        \"valid-lang\": { enabled: false }\n      };\n\n      /**\n       * Callback to catch results of the axe check.\n       *\n       * This callback is defined as separate plugin property to provide possibility to override it.\n       *\n       * @param {object|undefined} error - aXe error.\n       * @param {object} results - aXe results.\n       * @param {string} editorName - Name of CKEditor instance.\n       *\n       * @return {boolean} status.\n       */\n      axe.callback = function(error, results, editorName) {\n        if (error) throw error;\n        console.log(results);\n\n        // Validate editor instance.\n        if (typeof CKEDITOR.instances[editorName] === \"undefined\") {\n          // @todo: Multilanguage.\n          // @todo: Check if there is a way to provide multilanguage with dynamic argument in string.\n          console.error(\"Can't find editor instance.\");\n          return false;\n        }\n        let editor = CKEDITOR.instances[editorName];\n\n        // In case if we have at least one violation.\n        if (typeof results.violations === \"object\") {\n          // Collect information.\n          let violations = [];\n          let nodes = [];\n          results.violations.forEach(function(violation, vid) {\n            // In case if we have child elements.\n            if (typeof violation.nodes === \"object\") {\n              // Prepare violations array.\n              violations[vid] = {\n                title: violation.help,\n                description: violation.description\n              };\n              // Go through child elements.\n              violation.nodes.forEach(function(node) {\n                if (\n                  node.target[0] !== \"undefined\" &&\n                  typeof nodes[node.target[0]] === \"undefined\"\n                ) {\n                  nodes[node.target[0]] = editor.document.$.querySelector(\n                    node.target[0]\n                  );\n                  console.dir(nodes[node.target[0]]);\n                }\n              });\n            }\n          });\n          // @todo: Continue development.\n          console.log(violations);\n          console.log(nodes);\n        }\n\n        return true;\n      };\n\n      /**\n       * Path to aXe library on your website.\n       *\n       * Path is not defined yet.\n       * But you have two ways to define it:\n       * - First one is when you will add it to:\n       * CKEDITOR.config.axe.path = 'url://path/to/axe.min.js'\n       * - Second way is when you will include axe.js in <head> tag.\n       * And it will be detected automatically.\n       */\n      axe.path = undefined;\n\n      /**\n       * Method is created in order to override default axe settings with custom one.\n       *\n       * @todo: It should be tested.\n       *\n       * @param {object} settings - Custom settings object.\n       *\n       * @return {boolean} Status.\n       */\n      axe.override = function(settings) {\n        // Process settings object.\n        if (typeof settings !== \"undefined\") {\n          // Context.\n          if (typeof settings.context !== \"undefined\") {\n            this.context = settings.context;\n          }\n          // Arguments to run function (including rules which are not allowed.).\n          if (typeof settings.run !== \"undefined\") {\n            // There are some rules which can't be overriden.\n            let mandatoryRules = this.run.rules;\n            Object.keys(mandatoryRules).forEach(function(key) {\n              settings.run[key] = mandatoryRules[key];\n            });\n            this.run = settings.run;\n          }\n          // Callback to override default behavior.\n          if (typeof settings.callback === \"function\") {\n            this.callback = settings.callback;\n          }\n          // Path to aXe library.\n          if (typeof settings.path === \"string\") {\n            this.path = settings.path;\n          }\n        }\n        // Extra validation to aXe path library.\n        if (typeof this.path !== \"string\") {\n          // Get script by file name.\n          let scripts = document.querySelectorAll(\n            // @todo: Check compatibility of the attribute selectors.\n            \"script[src$='/axe.js'],script[src$='/axe.min.js']\"\n          );\n          // Set to static variable.\n          if (scripts.length) {\n            // @todo: Detect usage of min.js and dev version.\n            this.path = scripts[0].src;\n          } else {\n            console.error(\n              // @todo: Multilanguage.\n              \"Can't fin axe.js or axe.min.js file. Please check if they were included.\"\n            );\n            return false;\n          }\n        }\n        // Define callback number.\n        if (typeof this.callbackNumber === \"undefined\") {\n          this.callbackNumber = CKEDITOR.tools.addFunction(this.callback);\n        }\n        return true;\n      };\n\n      // Save our object into plugin.\n      this.axe = axe;\n    },\n\n    /**\n     * Plugin initialization logic goes inside this method.\n     *\n     * @param {object} editor - CKEditor editor object.\n     */\n    init: function(editor) {\n      // Get plugin definition.\n      let plugin = this;\n      // @todo: Multilanguage.\n      let lang = editor.lang.axe;\n      // Override default plugin settings.\n      plugin.axe.override(editor.config.axe);\n\n      // Add extra scripts when editor is ready.\n      editor.on(\"instanceReady\", function() {\n        let scripts = [plugin.axe.path, plugin.path + \"frame.js\"];\n        let frame = this;\n        scripts.forEach(function(src) {\n          frame.document.getHead().append(\n            frame.document.createElement(\"script\", {\n              attributes: { src: src, type: \"text/javascript\", defer: true }\n            })\n          );\n        });\n      });\n\n      // Create the toolbar button that executes the above command.\n      editor.ui.addButton(\"axe\", {\n        label: lang.name,\n        command: \"axe\",\n        icon: plugin.path + \"icons/axe.png\",\n        // According to other plugins - property \"toolbar\" should be added by default.\n        // @see plugins/about/plugin.js\n        toolbar: \"others\"\n      });\n\n      // Define the editor command.\n      editor.addCommand(\"axe\", {\n        canUndo: false,\n        // Define the function that will be fired when the command is executed.\n        exec: function(editor) {\n          // Prepare message.\n          let message = {\n            command: \"run\",\n            editor: editor.name,\n            arguments: {\n              context: plugin.axe.context,\n              options: plugin.axe.run,\n              callback: plugin.axe.callbackNumber\n            }\n          };\n          // Send message to iframe to run aXe.\n          editor.document.getWindow().$.postMessage(message);\n        }\n      });\n    }\n  });\n})(CKEDITOR);\n"],"sourceRoot":""}